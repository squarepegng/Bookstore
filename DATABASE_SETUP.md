# Supabase Database Setup

## Creating the Books Table

### Option 1: Using SQL (Recommended)

1. Log in to your Supabase Dashboard: https://app.supabase.com/
2. Go to your project: `ygiqbicywglcfernspov`
3. Click on **SQL Editor** in the left sidebar
4. Click **New Query**
5. Paste this SQL:

```sql
-- Create books table
CREATE TABLE IF NOT EXISTS books (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  title TEXT NOT NULL,
  author TEXT NOT NULL,
  description TEXT DEFAULT '',
  price DECIMAL(10, 2) NOT NULL,
  image_url TEXT DEFAULT '',
  payment_link TEXT DEFAULT '',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Enable Row Level Security (optional but recommended)
ALTER TABLE books ENABLE ROW LEVEL SECURITY;

-- Create policy to allow reading all books
CREATE POLICY "Allow anonymous reads" ON books
  FOR SELECT USING (true);

-- Create policy to allow inserts (protected by admin password check in app)
CREATE POLICY "Allow authenticated inserts" ON books
  FOR INSERT WITH CHECK (true);
```

6. Click **Run** (or press Cmd+Enter)
7. You should see "Success" message

### Option 2: Using UI

1. Go to **Table Editor** in your Supabase dashboard
2. Click **Create a new table**
3. Set table name: `books`
4. Add columns:
   - `id` - Type: `bigint`, Primary Key, Identity
   - `title` - Type: `text`, Required
   - `author` - Type: `text`, Required
   - `description` - Type: `text`, Default: empty string
   - `price` - Type: `numeric`, Precision: 10, Scale: 2
   - `image_url` - Type: `text`
   - `payment_link` - Type: `text`
   - `created_at` - Type: `timestamp`, Default: `now()`

## Verifying Your Table

After creating the table, verify it exists:

1. Go to **Table Editor** in Supabase dashboard
2. You should see `books` table listed
3. Click on it to verify all columns are present

## Sample Data (Optional)

To populate with sample books, run this SQL in **SQL Editor**:

```sql
INSERT INTO books (title, author, description, price, image_url, payment_link)
VALUES 
  (
    'The Great Gatsby',
    'F. Scott Fitzgerald',
    'A classic novel about the Jazz Age and the American Dream',
    12.99,
    'https://images.unsplash.com/photo-1543002588-d4d27c30c898?w=300',
    'https://example.com/buy/gatsby'
  ),
  (
    '1984',
    'George Orwell',
    'A dystopian social science fiction novel and cautionary tale',
    13.99,
    'https://images.unsplash.com/photo-1507842217343-583f7270bfba?w=300',
    'https://example.com/buy/1984'
  ),
  (
    'To Kill a Mockingbird',
    'Harper Lee',
    'A gripping tale of racial injustice and childhood innocence',
    14.99,
    'https://images.unsplash.com/photo-1519904981063-b0cf448d479e?w=300',
    'https://example.com/buy/mockingbird'
  );
```

## Checking Column Names

Column names in Supabase use **snake_case**, not camelCase:
- ✅ Correct: `image_url`, `payment_link`, `created_at`
- ❌ Incorrect: `imageUrl`, `paymentLink`, `createdAt`

Your frontend has been updated to use the correct names.

## Row Level Security (RLS)

By default, RLS might be disabled. For this app:

1. **Read Access:** Should be open to everyone (public read)
2. **Write Access:** Protected by `ADMIN_PASSWORD` in your application code

The RLS policies above allow:
- Anyone to read all books (public access)
- Anyone to insert books (actual authorization handled by app)

For production, you may want more strict policies.

## Testing Connection

After creating the table, test your backend connection:

1. Make sure `.env` has correct credentials
2. Run: `npm run dev` in the backend directory
3. Visit: http://localhost:5000/api/books
4. You should see a JSON response (empty array `[]` if no books yet)

## Troubleshooting

### "Relation does not exist" error
- **Problem:** Table wasn't created properly
- **Solution:** 
  1. Go to **Table Editor** in Supabase
  2. Check if `books` table is listed
  3. If not, create it again using the SQL above

### "Permission denied" error
- **Problem:** RLS policies blocking access
- **Solution:**
  1. Check Row Level Security is enabled
  2. Ensure policies are created as shown above
  3. If needed, disable RLS temporarily to test

### Column name mismatch errors
- **Problem:** Frontend is looking for `imageUrl` but database has `image_url`
- **Solution:**
  1. Verify your table columns use snake_case
  2. Confirm frontend components use snake_case field names
  3. Already fixed in provided files

## Security Notes

1. **ANON_KEY:** Currently used for read/write (fine for demo)
2. **ADMIN_PASSWORD:** Actual authorization layer in your app
3. **Production:** Consider using Row Level Security with user IDs

## Next Steps

1. ✅ Create the `books` table
2. ✅ (Optional) Add sample data
3. ✅ Test API endpoint
4. ✅ Deploy to Netlify
