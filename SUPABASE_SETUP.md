# Supabase Integration Guide

## Overview
Your Bookstore project has been successfully migrated from MongoDB to Supabase! This document explains the changes and how to set everything up.

## What Changed

### Backend Changes
1. **Removed MongoDB/Mongoose** dependency and replaced with Supabase
2. **Updated API routes** (`/api/books`) to use Supabase PostgreSQL queries
3. **Updated Netlify Functions** for serverless deployment with Supabase
4. **Environment variables** now use Supabase credentials instead of MongoDB URI

### Frontend Changes
1. **Updated column names** from camelCase (MongoDB) to snake_case (Supabase):
   - `_id` → `id`
   - `imageUrl` → `image_url`
   - `paymentLink` → `payment_link`
   - `createdAt` → `created_at`

2. **Components updated:**
   - `BookList.jsx` - Uses `id` instead of `_id`, `image_url` instead of `imageUrl`
   - `BookDetails.jsx` - Uses `image_url` and `payment_link`

## Supabase Database Schema

Your Supabase `books` table should have the following columns:

```sql
CREATE TABLE books (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  title TEXT NOT NULL,
  author TEXT NOT NULL,
  description TEXT DEFAULT '',
  price DECIMAL(10, 2) NOT NULL,
  image_url TEXT DEFAULT '',
  payment_link TEXT DEFAULT '',
  created_at TIMESTAMP DEFAULT NOW()
);
```

## Setup Instructions

### 1. Install Dependencies

In the backend directory, install the Supabase client:

```bash
cd backend
npm install
# This will install @supabase/supabase-js and other dependencies
```

Also update Netlify functions dependencies:

```bash
cd netlify/functions
npm install
```

### 2. Configure Environment Variables

The `.env` file in the `backend/` directory has been pre-populated with:
- `SUPABASE_URL` - Your Supabase project URL
- `SUPABASE_ANON_KEY` - Anonymous key for client-side requests (already provided)
- `ADMIN_PASSWORD` - Set this to a secure password
- `PORT` - Server port (default: 5000)

**Important:** Update `ADMIN_PASSWORD` with a strong, unique password!

### 3. Deploy to Netlify

When deploying to Netlify, add these environment variables in your Netlify dashboard:

```
SUPABASE_URL=https://ygiqbicywglcfernspov.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
ADMIN_PASSWORD=your_secure_password
```

### 4. Run Locally

To test locally:

```bash
cd backend
npm start
# Server will run on http://localhost:5000
```

For development with auto-reload:

```bash
npm run dev
```

## API Endpoints

### GET /api/books
Returns all books from Supabase, sorted by creation date (newest first).

**Response:**
```json
[
  {
    "id": 1,
    "title": "Book Title",
    "author": "Author Name",
    "description": "Book description",
    "price": 29.99,
    "image_url": "https://...",
    "payment_link": "https://...",
    "created_at": "2025-11-13T10:00:00Z"
  }
]
```

### POST /api/books/add
Adds a new book (requires admin password).

**Request Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "title": "New Book",
  "author": "Author Name",
  "price": 29.99,
  "adminPassword": "your_admin_password",
  "description": "Optional description",
  "imageUrl": "https://...",
  "paymentLink": "https://..."
}
```

**Response:**
```json
{
  "message": "Book added",
  "book": { /* full book object */ }
}
```

## Frontend Environment Variables

If needed, create a `.env` file in the `frontend/` directory:

```
VITE_API_URL=http://localhost:5000
```

For production/Netlify deployment, leave this empty so it uses relative paths to `.netlify/functions/`.

## Key Differences from MongoDB

1. **Primary Key:** Uses auto-incrementing `id` instead of MongoDB's `_id`
2. **Column Names:** Supabase uses snake_case by convention
3. **Timestamps:** `created_at` is automatically managed by Supabase
4. **No Mongoose:** Direct SQL queries via Supabase client
5. **Real-time Ready:** Supabase supports real-time subscriptions (if needed in future)

## Troubleshooting

### Books not loading?
- Check that `SUPABASE_URL` and `SUPABASE_ANON_KEY` are correctly set in `.env`
- Verify the `books` table exists in Supabase with correct column names
- Check browser console and server logs for error messages

### Admin password not working?
- Ensure `ADMIN_PASSWORD` matches between frontend and backend
- Make sure the password is not empty or undefined

### Column name errors?
- Verify Supabase table uses snake_case: `image_url`, `payment_link`, `created_at`
- Check that components use the correct field names

## Next Steps

1. ✅ Install dependencies: `npm install` in backend
2. ✅ Test locally: `npm run dev` in backend
3. ✅ Deploy to Netlify with environment variables
4. ✅ Test the frontend at your deployed URL

## Support

If you encounter any issues:
1. Check the error messages in browser console
2. Check server logs for backend errors
3. Verify all environment variables are set correctly
4. Ensure your Supabase table schema matches the expected structure
