# Quick Reference - Supabase Integration

## ğŸš€ Quick Start Commands

### Backend Setup
```bash
# Navigate to backend
cd backend

# Install dependencies
npm install

# Run development server (with auto-reload)
npm run dev

# Run production server
npm start
```

### Test API Endpoints

#### Get All Books
```bash
curl http://localhost:5000/api/books
```

#### Add a Book
```bash
curl -X POST http://localhost:5000/api/books/add \
  -H "Content-Type: application/json" \
  -d '{
    "title": "The Great Gatsby",
    "author": "F. Scott Fitzgerald",
    "price": 12.99,
    "description": "A classic novel of the Jazz Age",
    "imageUrl": "https://example.com/gatsby.jpg",
    "paymentLink": "https://example.com/buy/gatsby",
    "adminPassword": "your_admin_password"
  }'
```

## ğŸ“ Key Files Modified

```
backend/
â”œâ”€â”€ server.js                    âœ… Updated - Uses Supabase
â”œâ”€â”€ routes/books.js              âœ… Updated - Supabase queries
â”œâ”€â”€ package.json                 âœ… Updated - Added @supabase/supabase-js
â”œâ”€â”€ .env                         âœ… Created - Supabase credentials
â””â”€â”€ models/Book.js               âŒ No longer used (MongoDB schema)

frontend/
â””â”€â”€ src/components/
    â”œâ”€â”€ BookList.jsx             âœ… Updated - snake_case fields
    â”œâ”€â”€ BookDetails.jsx          âœ… Updated - snake_case fields
    â””â”€â”€ Admin.jsx                âœ… Works as-is

netlify/functions/
â”œâ”€â”€ get-books.js                 âœ… Updated - Supabase queries
â””â”€â”€ add-book.js                  âœ… Updated - Supabase insert
```

## ğŸ” Environment Variables

### Local Development (.env)
```env
SUPABASE_URL=https://ygiqbicywglcfernspov.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
ADMIN_PASSWORD=your_secure_password_here
PORT=5000
NODE_ENV=development
```

### Netlify Deployment
Set these in your Netlify dashboard â†’ Site settings â†’ Build & deploy â†’ Environment:
- `SUPABASE_URL`
- `SUPABASE_ANON_KEY`
- `ADMIN_PASSWORD`

## ğŸ“Š Supabase Table Schema

```sql
CREATE TABLE books (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  title TEXT NOT NULL,
  author TEXT NOT NULL,
  description TEXT DEFAULT '',
  price DECIMAL(10, 2) NOT NULL,
  image_url TEXT DEFAULT '',
  payment_link TEXT DEFAULT '',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## ğŸ”„ API Response Format

### Books List Response
```json
[
  {
    "id": 1,
    "title": "Book Title",
    "author": "Author Name",
    "description": "Description here",
    "price": 29.99,
    "image_url": "https://...",
    "payment_link": "https://...",
    "created_at": "2025-11-13T10:00:00+00:00"
  }
]
```

## ğŸ§ª Frontend Testing

### Local Frontend Development
```bash
cd frontend

# Install dependencies
npm install

# Run dev server (usually on http://localhost:5173)
npm run dev

# Build for production
npm build
```

### Environment Variable
Create `frontend/.env` if testing locally with custom API:
```env
VITE_API_URL=http://localhost:5000
```

For production, leave empty (uses relative `.netlify/functions/` paths).

## âš ï¸ Common Issues & Fixes

### Error: "SUPABASE_URL not set"
- **Solution:** Check `.env` file exists in `backend/` directory
- Verify `SUPABASE_URL` and `SUPABASE_ANON_KEY` are not empty

### Error: "Column not found: imageUrl"
- **Solution:** Frontend is using old MongoDB field names
- Already fixed in `BookList.jsx` and `BookDetails.jsx`
- Ensure you've updated both components

### Books table doesn't exist
- **Solution:** Create the table in Supabase dashboard
- Use the SQL schema provided above
- Or check table name is lowercase "books"

### Admin password always fails
- **Solution:** Ensure password matches between frontend form and backend `.env`
- Check for leading/trailing whitespace in password

## ğŸ“š Documentation Files

- **SUPABASE_SETUP.md** - Detailed setup guide
- **MIGRATION_SUMMARY.md** - Changes summary
- **This file** - Quick reference

## ğŸ”— Useful Links

- Supabase Dashboard: https://app.supabase.com/
- Your Project: https://app.supabase.com/project/ygiqbicywglcfernspov
- Netlify Dashboard: https://app.netlify.com/

## âœ… Integration Checklist

- [ ] Run `npm install` in backend
- [ ] Update `ADMIN_PASSWORD` in `.env`
- [ ] Test backend locally with `npm run dev`
- [ ] Verify books table exists in Supabase
- [ ] Test add-book endpoint with curl
- [ ] Run frontend locally with `npm run dev`
- [ ] Verify books load on frontend
- [ ] Set Netlify environment variables
- [ ] Deploy to Netlify
- [ ] Test production deployment
